<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Join to Mafia</title>
    <script>
        window.onload = function() {

            var formDom = document.getElementById("joinForm");
            var idCheckDom = document.getElementById("idCheckHiddenTag");
            var checkMsgDom = document.getElementById("noticePasswordEqual");

            document.getElementById("idRepeatCheckbtn").onclick = function() {
                var request = new XMLHttpRequest();
                request.onload = function() {
                    if(request.status == 200) {
                        var str = request.responseText;
                        var pDom = document.getElementById("noticeIdRepeated");
                        pDom.textContent = str;
                        if(str == "true") {
                            pDom.style.color = "red";
                        } else if(str == "false") {
                            idCheckDom.textContent = "checked";
                            pDom.style.color = "green";
                        }
                    }
                }
                request.open('POST','/mafia/idRepeatCheck',true);
                request.send('userid='+document.getElementById("userid").textContent+"&nickname="+document.getElementById("nickname").textContent);
            }

            document.getElementById("userid").onkeyup = function() {
                idCheckDom.textContent = "unchecked";
            }

            document.getElementById("passwordCheck").onkeyup = function() {
                var pwDom1 = document.getElementById("password");
                var pwDom2 = document.getElementById("passwordCheck");
                var color = checkMsgDom.style.color;
                var checkMsg = checkMsgDom.value;

                var pw1 = pwDom1.value;
                var pw2 = pwDom2.value;

                if(pw1 != pw2) {
                    if(color=="green" || !checkMsg) {
                        checkMsgDom.textContent = "비밀번호가 일치하지 않습니다!";
                        checkMsgDom.style.color = "red";
                    }
                } else if(pw1 == pw2) {
                    if(color=="red" || !checkMsg) {
                        checkMsgDom.textContent = "비밀번호가 일치합니다.";
                        checkMsgDom.style.color = "green";
                    }
                }
            }
        }

        function submitTrueCheck() {
            checkMsgDom = document.getElementById("noticePasswordEqual");
            idCheckDom = document.getElementById("idCheckHiddenTag");
            console.log(checkMsgDom.style.color);
            console.log(idCheckDom.textContent);
            if(checkMsgDom.style.color != "green" || idCheckDom.textContent != "checked") {
                if(idCheckDom.textContent != "checked"){
                    alert("아이디 중복체크를 해주세요!");
                }
                else if(checkMsgDom.style.color != "green") {
                    alert("비밀번호가 일치하지 않습니다!");
                }
                return false;
            }
            else return true;
        }
    </script>
</head>
<body>
    <div>
        <form id="joinForm" onsubmit="false">
            이름 : <input type="text" name="username" id="username" required>
            <br>
            아이디 : <input type="text" name="userid" id="userid" required>
            <button id="idRepeatCheckbtn" onclick="idRepeatCheckFun();" type="button">아이디 중복체크</button>
            <input type="hidden" id="idCheckHiddenTag" value="unchecked">
            <p id="noticeIdRepeated"></p>
            비밀번호 : <input type="password" name="password" id="password" required>
            <br>
            비밀번호 확인 : <input type="password" name="passwordCheck" id="passwordCheck" required>
            <p id="noticePasswordEqual"></p>
            닉네임 : <input type="text" name="nickname" id="nickname" required>
            <input type="submit" onclick="submitTrueCheck();" value="회원가입">
            <input type="button" id="cancleBtn" value="취소" onclick="window.close();">
        </form>
    </div>
</body>
</html>